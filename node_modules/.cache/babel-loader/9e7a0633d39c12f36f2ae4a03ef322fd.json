{"ast":null,"code":"import _slicedToArray from\"D:/funix/NJS301x_1.0-A_VN L\\u1EADp tr\\xECnh Web Back-End v\\u1EDBi NodeJS/assignment 03/Frontend Assignemnt 03 Admin App/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState}from\"react\";import'./auth.css';import{useDispatch}from\"react-redux\";import{setTouched}from\"../hook/lib\";import{useNavigate}from\"react-router-dom\";import Input from\"../UI/Input\";import ErrorModal from\"../UI/ErrorModal\";import{onBlurHandler,onChangeHanlder,validEmail,validLength,validRequire}from\"../../util/validators\";import PageContainer from\"../pageContainer/PageContainer\";import queryString from\"query-string\";import UserAPI from\"../../API/UserAPI\";import setCookie from\"../../setCookie\";import{addSession}from'../Redux/Action/ActionSession';import getCookie from\"../../getCookie\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Login=function Login(pros){var _useState=useState({value:'',valid:false,touched:false,validators:[validLength({min:4}),validEmail,validRequire]}),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState({value:'',valid:false,touched:false,validators:[validLength({min:4}),validRequire]}),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var dispatch=useDispatch();var navigate=useNavigate();var loginHandler=function loginHandler(e){e.preventDefault();setTouched(setEmail);setTouched(setPassword);console.log(email.value);if(email.valid){var params={email:email.value,password:password.value};var query='?'+queryString.stringify(params);UserAPI.postLogin(query).then(function(response){if(response){console.log(response);localStorage.setItem('id_user',response._id);localStorage.setItem('name_user',response.fullname);localStorage.setItem('user_token',response.token);var action=addSession(response);dispatch(action);setCookie('user_token',response.token,+1);console.log('token: '+getCookie('user_token'));navigate('/chat');}}).catch(function(err){console.log(err);setError({title:'Validation failed!',message:err.response.data.message});});};if(!email.valid||!password.valid){// console.log('no');\nreturn setError({title:'Validation failed!',message:'Invalid email or password!'});}};return/*#__PURE__*/_jsxs(_Fragment,{children:[error&&/*#__PURE__*/_jsx(ErrorModal,{title:error.title,message:error.message,onConfirm:function onConfirm(){return setError(null);},error:!!error}),/*#__PURE__*/_jsx(PageContainer,{children:/*#__PURE__*/_jsxs(\"main\",{className:\"centered\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Login\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(Input,{control:\"input\",id:\"email\",type:\"text\",placeholder:\"email\",required:true,onChange:function onChange(e){return onChangeHanlder(e,setEmail,email.validators);},onBlur:function onBlur(e){return onBlurHandler(e,setEmail,email.validators);},value:email.value,isValid:email.valid,isTouched:email.touched}),/*#__PURE__*/_jsx(Input,{control:\"input\",id:\"password\",type:\"password\",placeholder:\"password\",onChange:function onChange(e){return onChangeHanlder(e,setPassword,password.validators);},onBlur:function onBlur(e){return onBlurHandler(e,setPassword,password.validators);},required:true,value:password.value,isValid:password.valid,isTouched:password.touched}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn\",onClick:loginHandler,children:\"Login\"})]})]})})]});};export default Login;","map":{"version":3,"sources":["D:/funix/NJS301x_1.0-A_VN Lập trình Web Back-End với NodeJS/assignment 03/Frontend Assignemnt 03 Admin App/src/components/auth/Login.jsx"],"names":["useState","useDispatch","setTouched","useNavigate","Input","ErrorModal","onBlurHandler","onChangeHanlder","validEmail","validLength","validRequire","PageContainer","queryString","UserAPI","setCookie","addSession","getCookie","Login","pros","value","valid","touched","validators","min","email","setEmail","password","setPassword","error","setError","dispatch","navigate","loginHandler","e","preventDefault","console","log","params","query","stringify","postLogin","then","response","localStorage","setItem","_id","fullname","token","action","catch","err","title","message","data"],"mappings":"6MAAA,OAASA,QAAT,KAAyB,OAAzB,CACA,MAAO,YAAP,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA,OAASC,UAAT,KAA2B,aAA3B,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,MAAOC,CAAAA,KAAP,KAAkB,aAAlB,CACA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,OAASC,aAAT,CAAwBC,eAAxB,CAAyCC,UAAzC,CAAqDC,WAArD,CAAkEC,YAAlE,KAAsF,uBAAtF,CACA,MAAOC,CAAAA,aAAP,KAA0B,gCAA1B,CACA,MAAOC,CAAAA,WAAP,KAAwB,cAAxB,CACA,MAAOC,CAAAA,OAAP,KAAoB,mBAApB,CACA,MAAOC,CAAAA,SAAP,KAAsB,iBAAtB,CACA,OAASC,UAAT,KAA2B,+BAA3B,CACA,MAAOC,CAAAA,SAAP,KAAsB,iBAAtB,C,6IAEA,GAAMC,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACC,IAAD,CAAU,CACtB,cAA0BlB,QAAQ,CAAC,CACjCmB,KAAK,CAAE,EAD0B,CAEjCC,KAAK,CAAE,KAF0B,CAGjCC,OAAO,CAAE,KAHwB,CAIjCC,UAAU,CAAE,CAACb,WAAW,CAAC,CAAEc,GAAG,CAAE,CAAP,CAAD,CAAZ,CAA0Bf,UAA1B,CAAsCE,YAAtC,CAJqB,CAAD,CAAlC,wCAAOc,KAAP,eAAcC,QAAd,eAMA,eAAgCzB,QAAQ,CAAC,CACvCmB,KAAK,CAAE,EADgC,CAEvCC,KAAK,CAAE,KAFgC,CAGvCC,OAAO,CAAE,KAH8B,CAIvCC,UAAU,CAAE,CAACb,WAAW,CAAC,CAAEc,GAAG,CAAE,CAAP,CAAD,CAAZ,CAA0Bb,YAA1B,CAJ2B,CAAD,CAAxC,yCAAOgB,QAAP,eAAiBC,WAAjB,eAOA,eAA0B3B,QAAQ,EAAlC,yCAAO4B,KAAP,eAAcC,QAAd,eACA,GAAMC,CAAAA,QAAQ,CAAG7B,WAAW,EAA5B,CACA,GAAM8B,CAAAA,QAAQ,CAAG5B,WAAW,EAA5B,CAEA,GAAM6B,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,CAAD,CAAO,CAC1BA,CAAC,CAACC,cAAF,GAEAhC,UAAU,CAACuB,QAAD,CAAV,CACAvB,UAAU,CAACyB,WAAD,CAAV,CAEAQ,OAAO,CAACC,GAAR,CAAYZ,KAAK,CAACL,KAAlB,EAEA,GAAGK,KAAK,CAACJ,KAAT,CAAgB,CACd,GAAMiB,CAAAA,MAAM,CAAG,CACbb,KAAK,CAAEA,KAAK,CAACL,KADA,CAEbO,QAAQ,CAAEA,QAAQ,CAACP,KAFN,CAAf,CAIA,GAAMmB,CAAAA,KAAK,CAAG,IAAM1B,WAAW,CAAC2B,SAAZ,CAAsBF,MAAtB,CAApB,CACAxB,OAAO,CAAC2B,SAAR,CAAkBF,KAAlB,EACGG,IADH,CACQ,SAAAC,QAAQ,CAAI,CAChB,GAAGA,QAAH,CAAa,CACXP,OAAO,CAACC,GAAR,CAAYM,QAAZ,EACAC,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAgCF,QAAQ,CAACG,GAAzC,EACAF,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAkCF,QAAQ,CAACI,QAA3C,EACAH,YAAY,CAACC,OAAb,CAAqB,YAArB,CAAmCF,QAAQ,CAACK,KAA5C,EACA,GAAMC,CAAAA,MAAM,CAAGjC,UAAU,CAAC2B,QAAD,CAAzB,CACAZ,QAAQ,CAACkB,MAAD,CAAR,CACAlC,SAAS,CAAC,YAAD,CAAe4B,QAAQ,CAACK,KAAxB,CAA+B,CAAC,CAAhC,CAAT,CACAZ,OAAO,CAACC,GAAR,CAAY,UAAYpB,SAAS,CAAC,YAAD,CAAjC,EACAe,QAAQ,CAAC,OAAD,CAAR,CACD,CACF,CAbH,EAcGkB,KAdH,CAcS,SAAAC,GAAG,CAAI,CACZf,OAAO,CAACC,GAAR,CAAYc,GAAZ,EACArB,QAAQ,CAAC,CACPsB,KAAK,CAAE,oBADA,CAEPC,OAAO,CAAEF,GAAG,CAACR,QAAJ,CAAaW,IAAb,CAAkBD,OAFpB,CAAD,CAAR,CAID,CApBH,EAqBD,EAED,GAAG,CAAC5B,KAAK,CAACJ,KAAP,EAAgB,CAACM,QAAQ,CAACN,KAA7B,CAAoC,CAClC;AACA,MAAOS,CAAAA,QAAQ,CAAC,CACdsB,KAAK,CAAE,oBADO,CAEdC,OAAO,CAAE,4BAFK,CAAD,CAAf,CAID,CACF,CA5CD,CA8CA,mBACE,2BACGxB,KAAK,eACJ,KAAC,UAAD,EACE,KAAK,CAAEA,KAAK,CAACuB,KADf,CAEE,OAAO,CAAEvB,KAAK,CAACwB,OAFjB,CAGE,SAAS,CAAE,2BAAMvB,CAAAA,QAAQ,CAAC,IAAD,CAAd,EAHb,CAIE,KAAK,CAAE,CAAC,CAACD,KAJX,EAFJ,cASE,KAAC,aAAD,wBACE,cAAM,SAAS,CAAC,UAAhB,wBACE,6BADF,cAEE,cAAM,SAAS,CAAC,YAAhB,wBACE,KAAC,KAAD,EACE,OAAO,CAAC,OADV,CAEE,EAAE,CAAC,OAFL,CAGE,IAAI,CAAC,MAHP,CAIE,WAAW,CAAC,OAJd,CAKE,QAAQ,CAAE,IALZ,CAME,QAAQ,CAAE,kBAAAK,CAAC,QAAI1B,CAAAA,eAAe,CAAC0B,CAAD,CAAIR,QAAJ,CAAcD,KAAK,CAACF,UAApB,CAAnB,EANb,CAOE,MAAM,CAAE,gBAAAW,CAAC,QAAI3B,CAAAA,aAAa,CAAC2B,CAAD,CAAIR,QAAJ,CAAcD,KAAK,CAACF,UAApB,CAAjB,EAPX,CAQE,KAAK,CAAEE,KAAK,CAACL,KARf,CASE,OAAO,CAAEK,KAAK,CAACJ,KATjB,CAUE,SAAS,CAAEI,KAAK,CAACH,OAVnB,EADF,cAaE,KAAC,KAAD,EACE,OAAO,CAAC,OADV,CAEE,EAAE,CAAC,UAFL,CAGE,IAAI,CAAC,UAHP,CAIE,WAAW,CAAC,UAJd,CAKE,QAAQ,CAAE,kBAAAY,CAAC,QAAI1B,CAAAA,eAAe,CAAC0B,CAAD,CAAIN,WAAJ,CAAiBD,QAAQ,CAACJ,UAA1B,CAAnB,EALb,CAME,MAAM,CAAE,gBAAAW,CAAC,QAAI3B,CAAAA,aAAa,CAAC2B,CAAD,CAAIN,WAAJ,CAAiBD,QAAQ,CAACJ,UAA1B,CAAjB,EANX,CAOE,QAAQ,CAAE,IAPZ,CAQE,KAAK,CAAEI,QAAQ,CAACP,KARlB,CASE,OAAO,CAAEO,QAAQ,CAACN,KATpB,CAUE,SAAS,CAAEM,QAAQ,CAACL,OAVtB,EAbF,cAyBE,eACE,IAAI,CAAC,QADP,CAEE,SAAS,CAAC,KAFZ,CAGE,OAAO,CAAEW,YAHX,mBAzBF,GAFF,GADF,EATF,GADF,CAgDD,CAhHD,CAkHA,cAAef,CAAAA,KAAf","sourcesContent":["import { useState } from \"react\";\r\nimport './auth.css'\r\nimport { useDispatch } from \"react-redux\";\r\nimport { setTouched } from \"../hook/lib\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport Input from \"../UI/Input\";\r\nimport ErrorModal from \"../UI/ErrorModal\";\r\nimport { onBlurHandler, onChangeHanlder, validEmail, validLength, validRequire } from \"../../util/validators\";\r\nimport PageContainer from \"../pageContainer/PageContainer\";\r\nimport queryString from \"query-string\";\r\nimport UserAPI from \"../../API/UserAPI\";\r\nimport setCookie from \"../../setCookie\";\r\nimport { addSession } from '../Redux/Action/ActionSession';\r\nimport getCookie from \"../../getCookie\";\r\n\r\nconst Login = (pros) => {\r\n  const [email, setEmail] = useState({\r\n    value: '',\r\n    valid: false,\r\n    touched: false,\r\n    validators: [validLength({ min: 4 }), validEmail, validRequire]\r\n  });\r\n  const [password, setPassword] = useState({\r\n    value: '',\r\n    valid: false,\r\n    touched: false,\r\n    validators: [validLength({ min: 4 }), validRequire]\r\n  });\r\n\r\n  const [error, setError] = useState();\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  const loginHandler = (e) => {\r\n    e.preventDefault();\r\n\r\n    setTouched(setEmail);\r\n    setTouched(setPassword);\r\n\r\n    console.log(email.value);\r\n\r\n    if(email.valid) {\r\n      const params = {\r\n        email: email.value,\r\n        password: password.value\r\n      }\r\n      const query = '?' + queryString.stringify(params);\r\n      UserAPI.postLogin(query)\r\n        .then(response => {\r\n          if(response) {\r\n            console.log(response);\r\n            localStorage.setItem('id_user', response._id);\r\n            localStorage.setItem('name_user', response.fullname);\r\n            localStorage.setItem('user_token', response.token);\r\n            const action = addSession(response);\r\n            dispatch(action);\r\n            setCookie('user_token', response.token, +1);\r\n            console.log('token: ' + getCookie('user_token'));\r\n            navigate('/chat');\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n          setError({\r\n            title: 'Validation failed!',\r\n            message: err.response.data.message\r\n          })\r\n        });\r\n    };\r\n\r\n    if(!email.valid || !password.valid) {\r\n      // console.log('no');\r\n      return setError({\r\n        title: 'Validation failed!',\r\n        message: 'Invalid email or password!'\r\n      })\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {error && (\r\n        <ErrorModal\r\n          title={error.title}\r\n          message={error.message}\r\n          onConfirm={() => setError(null)}\r\n          error={!!error}\r\n        />\r\n      )}\r\n      <PageContainer>\r\n        <main className=\"centered\">\r\n          <h1>Login</h1>\r\n          <form className=\"form-group\">\r\n            <Input\r\n              control=\"input\"\r\n              id=\"email\"\r\n              type=\"text\" \r\n              placeholder=\"email\" \r\n              required={true}\r\n              onChange={e => onChangeHanlder(e, setEmail, email.validators)}\r\n              onBlur={e => onBlurHandler(e, setEmail, email.validators)}\r\n              value={email.value}\r\n              isValid={email.valid}\r\n              isTouched={email.touched}\r\n            />\r\n            <Input \r\n              control=\"input\"\r\n              id=\"password\"\r\n              type=\"password\" \r\n              placeholder=\"password\"\r\n              onChange={e => onChangeHanlder(e, setPassword, password.validators)}\r\n              onBlur={e => onBlurHandler(e, setPassword, password.validators)}\r\n              required={true}\r\n              value={password.value}\r\n              isValid={password.valid}\r\n              isTouched={password.touched}\r\n            />\r\n            <button \r\n              type=\"submit\" \r\n              className=\"btn\"\r\n              onClick={loginHandler}\r\n            >Login</button>\r\n          </form>\r\n        </main>\r\n      </PageContainer>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Login;"]},"metadata":{},"sourceType":"module"}